@model ResourceManagement.Models.RMA_EmployeeModel

@{
    ViewBag.Title = "TimeSheets View Report partial Page";
}

<style>
    .headerrow {
        border: 0px !important;
        padding: 2px !important;
        background-color: LightGray;
    }

    .headertd {
        font-size: small;
        border-right: 1px solid lightgray !important;
    }

    .center {
        margin-top: 3px;
        width: 100%;
        border: 1px solid black;
        padding: 6px;
        background-color: LightGray;
    }

    #timesheet-table th, td {
        border: 1px solid gray;
    }

    .table-leaveinfo th, td {
        border: 1px solid gray;
    }
</style>

@if (Model != null)
{
    <div id="demo" class="carousel slide" data-ride="carousel">

        <!-- Indicators -->
        @{
            int Indicatori = 0;
        }
        <ol class="carousel-indicators">
            @foreach (var employeeReport in Model.TimeSheetReports)
            {
                var isactiveclass = Indicatori == 0 ? "active" : "";
                Indicatori++;

                <li data-target="#demo" data-slide-to="@Indicatori" class="@isactiveclass"></li>
            }
        </ol>

        <!-- The slideshow -->
        <div class="carousel-inner">
            @{
                int i = 0;
            }

            @foreach (var employeeReport in Model.TimeSheetReports)
            {
                Int32? totalhoursSpentInTheWeek = 0;
                Int32? totalBillableHours = 0;
                Int32? totalNonBillableHours = 0;

                var isactiveclass = i == 0 ? "active" : "";
                i++;
                <div class="carousel-item @isactiveclass">
                    <div class="card timesheet-card partialview-reports">
                        <div class="card-body ">
                            <div class="emailbodycontent">
                                <div class="table-responsive table">
                                    <table>
                                        <tr>
                                            <td style="width: 100%; padding-left: 0px; text-align: center; border: 1px solid black; padding-top: 0px; padding-right: 0px; padding-bottom:0px">
                                                <table style="width:100%">
                                                    <tr><td colspan="4" class="headerrow"><h2><b>@employeeReport.EmployeeInfo.Designation Weekly Project Status Report</b></h2></td></tr>
                                                    <tr style="text-align:left">
                                                        <td class="headertd">
                                                            <b>Resource Name</b>
                                                        </td>
                                                        <td class="headertd">
                                                            @employeeReport.EmployeeInfo.Employee_Name
                                                        </td>
                                                        <td class="headertd"><b>Project Manager</b></td>
                                                        <td class="headertd">
                                                            @employeeReport.EmployeeInfo.Client_Report_Manager
                                                        </td>
                                                    </tr>
                                                    <tr style="text-align:left">

                                                        @{
                                                            var requiredWeekSatartDate = "NA";
                                                            var requiredWeekEndDate = "NA";
                                                        }
                                                        @if (@employeeReport.timeSheetInfo != null && @employeeReport.timeSheetInfo.Count > 0)
                                                        {
                                                            var reportStartdate = @employeeReport.timeSheetInfo[0].weekstartdate.ToString().Replace("00:00:00", "").Replace("12:00:00 AM", "").Replace('/', '-').Trim().Split('-');
                                                            requiredWeekSatartDate = reportStartdate[2].Trim() + "-" + reportStartdate[1] + "-" + reportStartdate[0];

                                                            var reportEndtdate = @employeeReport.timeSheetInfo[0].weekenddate.ToString().Replace("00:00:00", "").Replace("12:00:00 AM", "").Replace('/', '-').Trim().Split('-');
                                                            requiredWeekEndDate = reportEndtdate[2].Trim() + "-" + reportEndtdate[1] + "-" + reportEndtdate[0];
                                                        }

                                                        <td class="headertd"><b>Week Start Date</b></td>
                                                        <td class="headertd">@requiredWeekSatartDate</td>
                                                        <td class="headertd">
                                                            <b>Week End Date</b>
                                                        </td>
                                                        <td class="headertd">
                                                            @requiredWeekEndDate
                                                        </td>
                                                    </tr>
                                                </table>
                                            </td>
                                            <td style="width: 30%">
                                                <img class=" preload-me" src="https://ambconline.com/wp-content/uploads/2020/12/188x80.png" srcset="https://ambconline.com/wp-content/uploads/2020/12/188x80.png 188w, https://ambconline.com/wp-content/uploads/2020/12/188x80.png 188w" width="188" height="80" sizes="188px" alt="AMBC Inc">
                                            </td>
                                        </tr>
                                    </table>

                                    <div class="center"><b>EFFORT DETAILS (current week)</b></div>
                                    <table class="table" id="timesheet-table" style="margin-top: 2px">
                                        <thead class="table-bordered">
                                            <tr style="background-color: #BCD2E8">
                                                <th class="" scope="col" style="max-width:70px; text-align: center">Day</th>
                                                <th class="" scope="col" style="max-width: 100px; text-align: center">Category</th>
                                                <th class="" scope="col" style="max-width: 200px; text-align: center">Incident Number</th>
                                                <th class="" scope="col" style="max-width: 200px; text-align: center">Incident Desc</th>
                                                <th class="" scope="col" style="text-align: center">Requester</th>
                                                <th class="" scope="col" style="text-align: center">Priority</th>
                                                <th class="" scope="col" style="text-align: center">Status</th>
                                                <th class="" scope="col" style="text-align: center">Time Spent</th>
                                                <th class="" scope="col" style="text-align: center">Comments</th>
                                            </tr>
                                        </thead>

                                        <tbody class="timesheet-table-grid">

                                            @if (employeeReport.timeSheetInfo.Count > 0)
                                            {

                                                foreach (var task in employeeReport.timeSheetInfo)
                                                {
                                                    <tr style="background-color: #fff" class="time">
                                                        @{
                                                            var requiredDate = task.taskdate.ToString().Contains("00:00:00") ? task.taskdate.ToString().Replace("00:00:00", "").Replace("12:00:00 AM", "").Split('-') : task.taskdate.ToString().Replace("00:00:00", "").Replace("12:00:00 AM", "").Split('-');

                                                            var taskDisplayDate = requiredDate[2].Trim() + "-" + requiredDate[1] + "-" + requiredDate[0];

                                                            var overtTimeHours = task.overtime != null ? task.overtime : 0;
                                                            var totalSpentHours = System.Convert.ToInt32(task.timespent) + overtTimeHours;

                                                            totalhoursSpentInTheWeek += totalSpentHours;

                                                            totalBillableHours += System.Convert.ToInt32(task.timespent);

                                                            totalNonBillableHours += overtTimeHours;
                                                        }

                                                        <td scope="row" style="max-width:70px; vertical-align:middle; text-align: center">@taskDisplayDate</td>
                                                        <td scope="row" style="max-width: 100px; vertical-align: middle; text-align: center">@task.category</td>
                                                        <td scope="row" style="max-width: 200px; vertical-align: middle; text-align: center">@task.incidentnumber</td>
                                                        <td scope="row" style="max-width: 200px; vertical-align: middle; text-align: center">@task.taskdetails</td>
                                                        <td scope="row" style="vertical-align: middle; text-align: center">@task.requester</td>
                                                        <td scope="row" style="vertical-align: middle; text-align: center">@task.callpriority</td>
                                                        <td scope="row" style="vertical-align: middle; text-align: center">@task.projstatus</td>
                                                        <td scope="row" style="text-align:center; vertical-align:middle">@totalSpentHours</td>
                                                        <td scope="row" style="max-width: 200px; vertical-align: middle; text-align: center">@task.comments</td>
                                                    </tr>
                                                }
                                            }
                                            else
                                            {
                                                <tr>
                                                    <td colspan="9">
                                                        <h2><b>NO RECORDS FOUND</b></h2>
                                                    </td>
                                                </tr>
                                            }


                                        </tbody>
                                    </table>

                                    <div class="center"><b>Leave Information</b></div>

                                    <table class="table-leaveinfo" style="margin-top: 4px; width:34%">
                                        <thead class="table-bordered">
                                            <tr style="background-color: #BCD2E8">
                                                <th class="" scope="col">Leave Date</th>
                                                <th class="" scope="col">Leave Type</th>
                                            </tr>
                                        </thead>

                                        <tbody class="timesheet-table-grid">

                                            @if (employeeReport.timeSheetLeaveOrHolidayInfo != null && employeeReport.timeSheetLeaveOrHolidayInfo.Count > 0)
                                            {
                                                foreach (var leaveReport in employeeReport.timeSheetLeaveOrHolidayInfo)
                                                {

                                                    var requiredLeaveDate = leaveReport.taskdate.ToString().Contains("00:00:00") ? leaveReport.taskdate.ToString().Replace("00:00:00", "").Replace("12:00:00 AM", "").Split('-') : leaveReport.taskdate.ToString().Replace("00:00:00", "").Replace("12:00:00 AM", "").Split('-');
                                                    var leaveDisplayDate = requiredLeaveDate[2].Trim() + "-" + requiredLeaveDate[1] + "-" + requiredLeaveDate[0];


                                                    <tr style="background-color: #ccffcc">
                                                        <td scope="row">@leaveDisplayDate</td>
                                                        <td scope="row">@leaveReport.comments</td>
                                                    </tr>
                                                }
                                            }
                                            else
                                            {
                                                <tr style="background-color: #ccffcc">
                                                    <td scope="row">NA</td>
                                                    <td scope="row">NA</td>
                                                </tr>
                                            }

                                        </tbody>
                                    </table>

                                    @{
                                        int? billableHours = 0;
                                        int? nonBillableHours = 0;
                                    }

                                    <table class="table-billableinfo" style="margin-top: 15px;">

                                        @if (totalhoursSpentInTheWeek >= 40)
                                        {
                                            billableHours = 40;
                                            nonBillableHours = totalhoursSpentInTheWeek - 40;
                                        }
                                        else
                                        {
                                            billableHours = totalhoursSpentInTheWeek;
                                        }

                                        <tr style="background-color: #ccffcc; ">
                                            <td style="width: 368px; border: 1px solid black; background-color: white; font-size: initial; padding: 3px;"><b>Total Billable Hours (till date)</b></td>
                                            <td style="border:none; background-color:white"></td>
                                            <td style="border:1px solid black; background-color:white; width: 30px"><b>@totalBillableHours</b></td>
                                        </tr>
                                    </table>

                                    <table class="table-billableinfo" style="margin-top: 15px;">

                                        <tr style="background-color: #ccffcc; ">
                                            <td style="width: 368px; border: 1px solid black; background-color: white; font-size: initial; padding: 3px;"><b>Total Nonbillable Hours (till date)</b></td>
                                            <td style="border:none; background-color:white"></td>
                                            <td style="border:1px solid black; background-color:white; width: 30px"><b>@totalNonBillableHours</b></td>
                                        </tr>
                                    </table>

                                    <table class="table-billableinfo" style="margin-top: 15px;">

                                        <tr style="background-color: #ccffcc; ">
                                            <td style="width: 368px; border: 1px solid black; background-color: white; font-size: initial; padding: 3px;"><b>Total Entire Project Efforts</b></td>
                                            <td style="border:none; background-color:white"></td>
                                            <td style="border:1px solid black; background-color:white; width: 30px"><b>@totalhoursSpentInTheWeek</b></td>
                                        </tr>
                                    </table>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>


        <a class="carousel-control-prev" href="#demo" data-slide="prev" style="display:none">
            <span class="carousel-control-prev-icon" style="background-color: gray; margin-left: -164px; height: 40px;"></span>
        </a>
        <a class="carousel-control-next" href="#demo" data-slide="next" style="display:none">
            <span class="carousel-control-next-icon" style="background-color: gray; height: 40px; margin-right: -164px;"></span>
        </a>

        @if (Model.TimeSheetReports != null && Model.TimeSheetReports.Count > 1)
        {
            <script>
                jQuery('.carousel-control-prev').show();
                jQuery('.carousel-control-next').show();
            </script>

        }


    </div>
}

<br />
<br />
<br />

